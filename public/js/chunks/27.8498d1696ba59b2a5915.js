(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{ctCr:function(e,t,n){"use strict";var a=n("h0/l"),r=n.n(a),o=n("q1tI"),c=n.n(o),i=n("24R3");function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=h(e);if(t){var r=h(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return d(this,n)}}function d(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(s,e);var t,n,a,o=m(s);function s(){return u(this,s),o.apply(this,arguments)}return t=s,(n=[{key:"render",value:function(){return c.a.createElement(r.a,l({title:c.a.createElement(i.a,{defaultMessage:"Are you sure?",id:"common.popconfirm_title"}),cancelText:c.a.createElement(i.a,{defaultMessage:"No",id:"common.no"}),okText:c.a.createElement(i.a,{defaultMessage:"Yes",id:"common.yes"})},this.props))}}])&&f(t.prototype,n),a&&f(t,a),s}(o.Component);t.a=y},hyda:function(e,t,n){"use strict";n.r(t);var a=n("Btem"),r=n.n(a),o=n("q1tI"),c=n.n(o),i=n("iNPk"),s=n("/MKj"),l=n("Ty5D"),u=n("vVgw"),f=n("4IMT"),p=n.n(f),m=n("24R3");function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=E(e);if(t){var r=E(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return v(this,n)}}function v(e,t){if(t&&("object"===d(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(o,e);var t,n,a,r=g(o);function o(){return h(this,o),r.apply(this,arguments)}return t=o,(n=[{key:"render",value:function(){var e=this.props.onToggleDrawer;return c.a.createElement("div",{className:"cp-comment-box"},c.a.createElement("div",{className:"cp-fs-80"},c.a.createElement("i",{className:"la la-comments"})),c.a.createElement("h1",{className:"text-muted"},c.a.createElement(m.a,{defaultMessage:"Select Chat to Begin!",id:"chat.select_to_begin"})),c.a.createElement(p.a,{type:"primary",className:"d-block d-lg-none mt-3",onClick:e},c.a.createElement(m.a,{defaultMessage:"Show Chats",id:"chat.show_chats"})))}}])&&y(t.prototype,n),a&&y(t,a),o}(o.Component),O=n("tE8B"),_=n.n(O),j=n("MM9K"),S=n.n(j),k=n("iJl9"),P=n.n(k),T=n("Pbn2"),M=n.n(T),C=n("RWbP"),N=n.n(C),x=n("qPyV"),R=n.n(x),D=n("UfWW"),A=n.n(D),U=n("E+oP"),B=n.n(U),F=n("hqwM"),I=n.n(F),L=n("7++0"),W=n("zSVi"),V=n("amnm"),z=n("J2m7"),K=n.n(z),q=n("pWf2"),H=n.n(q),G=n("DRDh"),J=n("Falu"),Q=n("fVSG"),Y=n("wUfQ");function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function X(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=ae(e);if(t){var r=ae(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return te(this,n)}}function te(e,t){if(t&&("object"===Z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ne(e)}function ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ae(e){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$(e,t)}(o,e);var t,n,a,r=ee(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),re(ne(t=r.call(this,e)),"chatParticipationChangedListener",(function(e){B()(e)||t.props.auth.user.id===e.user_id&&t.setState({participation:e})})),re(ne(t),"chatUpdatedListener",(function(e){var n=t.api,a=n.axios,r=n.route;if(!B()(e.chat)){t.fetchParticipation();var o=r("chats.get",{chat:e.chat.id});a.post(o.url()).then((function(e){return Object(Q.d)(e,(function(e){t.updateChat(e)}))})).catch((function(e){return Object(Q.a)(e)}))}})),re(ne(t),"getUserAvatar",(function(){var e=t.getHighlightedParticipant();return B()(e)?c.a.createElement(H.a,{icon:"message",size:50}):c.a.createElement(V.a,{user:e.user,size:50})})),re(ne(t),"getMessageDetail",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;switch(e.type){case"activity":return t.getActivityDetail(e.activity,n);case"text":return t.getTextDetail(e.text,n);case"attachment":return t.getAttachmentDetail(e.attachment,n);default:return null}})),re(ne(t),"getTextDetail",(function(e,t){return B()(e)?c.a.createElement("span",null,c.a.createElement("i",{className:"la la-ban mr-1"}),c.a.createElement("span",null,c.a.createElement(m.a,{defaultMessage:"Message Deleted",id:"chats.message_deleted"}))):c.a.createElement("span",null,Object(i.f)(e.body,t))})),re(ne(t),"getAttachmentDetail",(function(e,t){return B()(e)?c.a.createElement("span",null,c.a.createElement("i",{className:"la la-ban mr-1"}),c.a.createElement("span",null,c.a.createElement(m.a,{defaultMessage:"Message Deleted",id:"chats.message_deleted"}))):c.a.createElement("span",null,c.a.createElement("i",{className:"la la-paperclip mr-1"}),c.a.createElement("span",null,Object(i.f)(e.name,t)))})),re(ne(t),"getActivityDetail",(function(e,t){return e&&c.a.createElement("span",null,Object(i.f)(e.body,t))})),re(ne(t),"handleClick",(function(){var e=t.props,n=e.onOpen,a=e.chat;if("function"==typeof n)return n(a)})),t.broadcast=new G.a,t.api=new J.b,t.state={participation:{}},t}return t=o,(n=[{key:"componentDidMount",value:function(){this.bindBroadcastEvents(),this.fetchParticipation()}},{key:"bindBroadcastEvents",value:function(){this.resetBroadcastChannel(),this.broadcast.listen("ChatParticipationChanged",this.chatParticipationChangedListener),this.broadcast.listen("ChatUpdated",this.chatUpdatedListener)}},{key:"updateChat",value:function(e){var t=this.props.onChatUpdated;if("function"==typeof t)return t(e)}},{key:"resetBroadcastChannel",value:function(){var e=this.props.chat;B()(e)?this.broadcast.unbind():this.broadcast.setChannel("App.Chat."+e.id)}},{key:"fetchParticipation",value:function(){var e=this,t=this.api,n=t.axios,a=(0,t.route)("chats.participation",{chat:this.props.chat.id});n.post(a.url()).then((function(t){return Object(Q.d)(t,(function(t){e.setState({participation:t})}))})).catch((function(e){return Object(Q.a)(e)}))}},{key:"componentDidUpdate",value:function(e,t,n){var a=e.chat,r=this.props.chat;a.id!==r.id&&(console.info("ChatCell Updated"),this.resetBroadcastChannel())}},{key:"componentWillUnmount",value:function(){this.broadcast.unbind(),this.api.cancel()}},{key:"getTitle",value:function(){var e=this.props.chat,t=this.getHighlightedParticipant();if(B()(t))return c.a.createElement(m.a,{defaultMessage:"Conversation",id:"chats.conversation"});var n=t.user.name;return e.participants.length>1&&(n=c.a.createElement(m.a,{id:"chats.cell_title",defaultMessage:"{user} and {total} other(s)",values:{total:e.participants.length-1,user:t.user.name}})),c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{className:"font-weight-medium"},n))}},{key:"getUser",value:function(e){var t=this.props,n=t.chat,a=t.auth,r=n.participants;if(a.user.id===e)return a.user;var o=K()(r,(function(t){return!B()(t.user)&&t.user.id===e}));return B()(o)?o:o.user}},{key:"getLastMessage",value:function(){var e=this.props,t=e.chat,n=e.auth,a=t.latest_message,r=t.participants;if(B()(a))return null;var o=a.user;return B()(o)?c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{className:"font-weight-medium mr-1"},c.a.createElement(m.a,{defaultMessage:"Unknown User",id:"common.unknown_user"}),":"),this.getMessageDetail(a,20)):o.id===n.user.id?c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{className:"font-weight-medium mr-1"},c.a.createElement(m.a,{defaultMessage:"Me",id:"common.me"}),":"),this.getMessageDetail(a,23)):r.length>1?c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{className:"font-weight-medium mr-1"},o.name,":"),this.getMessageDetail(a,20)):this.getMessageDetail(a,25)}},{key:"getHighlightedParticipant",value:function(){if(B()(this.highlightedParticpant)){var e=this.props,t=e.chat,n=e.auth,a=t.participants;this.highlightedParticpant=K()(a,(function(e){return!B()(e.user)&&e.user.id!==n.user.id}))}return this.highlightedParticpant}},{key:"getTime",value:function(){var e=this.props.chat.latest_message;return B()(e)?null:Object(i.g)(e.created_at)}},{key:"getUnreadCount",value:function(){var e=this.state.participation;if(this.props.active||B()(e))return null;var t=e.unread_messages_count;return!t||t<=0?null:Object(Y.a)(t)}},{key:"render",value:function(){var e=this.getUnreadCount(),t=this.props.active,n="cp-chat-user-item ".concat(t&&"active");return c.a.createElement("div",{className:n,onClick:this.handleClick},c.a.createElement("div",{className:"cp-chat-user-row"},c.a.createElement("div",{className:"cp-chat-avatar"},this.getUserAvatar()),c.a.createElement("div",{className:"cp-chat-info"},c.a.createElement("span",{className:"cp-chat-name h4"},this.getTitle()),c.a.createElement("div",{className:"cp-chat-desc"},this.getLastMessage()),c.a.createElement("div",{className:"cp-chat-time"},this.getTime())),c.a.createElement("div",{className:"cp-chat-date"},e&&c.a.createElement("div",{className:"badge"},e))))}}])&&X(t.prototype,n),a&&X(t,a),o}(o.Component),ce=n("RotF"),ie=n.n(ce),se=n("mP/V"),le=n("v1ta"),ue=n("pvl8"),fe=n("VWBV");function pe(e){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){_e(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function he(e){return function(e){if(Array.isArray(e))return ye(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ye(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ye(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function be(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ge(e,t){return(ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Oe(e);if(t){var r=Oe(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Ee(this,n)}}function Ee(e,t){if(t&&("object"===pe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return we(e)}function we(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Oe(e){return(Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var je=I.a.Item,Se=Object(L.a)({searchUsers:{id:"chats.input_filter_by_contact_name_placeholder",defaultMessage:"Filter by contact name..."}}),ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(o,e);var t,n,a,r=ve(o);function o(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),_e(we(t=r.call(this,e)),"chatParticipantCreatedListener",(function(e){var n=t.api,a=n.axios,r=n.route;if(!B()(e.participant)){var o=r("chats.get",{chat:e.participant.chat_id});a.post(o.url()).then((function(e){return Object(Q.d)(e,(function(e){t.setState((function(n){var a=n.data.concat(e);return{data:t.sortChats(a)}}))}))})).catch((function(e){return Object(Q.a)(e)}))}})),_e(we(t),"onChatUpdated",(function(e){var n=t.state.data,a=A()(n,(function(t){return t.id===e.id})),r=he(n);a<0?r=r.concat(e):r[a]=e,r=t.sortChats(r),t.setState({data:r})})),_e(we(t),"sortChats",(function(e){return Array.isArray(e)?(e=e.sort((function(e,t){return Object(i.d)(t.updated_at,e.updated_at)})),R()(e,"id")):e})),_e(we(t),"fetchChats",(function(){var e=t.state,n=e.params,a=e.filters,r=de(de({},n),{},{current:1});t.pagination.fetchData(r,a,(function(e){t.setState((function(){return{params:de(de({},r),{},{total:e.meta.total}),data:e.data,loading:!1,hasMore:Boolean(e.links.next)}}))}),(function(){t.setState({loading:!1})})),t.setState({loading:!0})})),_e(we(t),"onChangeUserSearch",(function(e){var n=e.target.value;clearTimeout(t.searching);var a=t.state.filters;t.canSearchUser()&&(t.setState({filters:de(de({},a),{},{user:n})}),t.searching=setTimeout(t.fetchChats,2e3))})),_e(we(t),"onSearchKeyUp",(function(e){"Enter"===e.key&&(clearTimeout(t.searching),t.fetchChats())})),_e(we(t),"onLoadMore",(function(e){if(t.canLoadMore()){var n=t.state,a=n.params,r=n.filters,o=de(de({},a),{},{current:a.current+1});t.pagination.fetchData(o,r,(function(e){t.setState((function(n){var a=n.data.concat(e.data);return{data:t.sortChats(a),params:de(de({},o),{},{total:e.meta.total}),loadingMore:!1,hasMore:Boolean(e.links.next)}}))}),(function(){t.setState({loadingMore:!1})})),t.setState({loadingMore:!0})}})),_e(we(t),"handleChatOpen",(function(e){var n=t.props.history,a=Object(l.f)(fe.a["chat.view"].path,{token:e.id});if(!B()(n))return n.replace(a)})),_e(we(t),"setScrollWrapper",(function(e){if(e!==t.scrollWrapper&&null!==e){var n=new ue.a(e);t.scrollParent=n.getScrollElement(),t.scrollWrapper=e}})),t.broadcast=new G.a,t.api=new J.b,t.state={data:[],hasMore:!1,params:{total:0,pageSize:20,current:1},filters:{user:""},loadingMore:!1,loading:!1};var n=t.api.route("chats.table").url();return t.pagination=new se.a(t.api,n),t}return t=o,(n=[{key:"componentDidMount",value:function(){this.bindBroadcastEvents(),this.fetchChats()}},{key:"bindBroadcastEvents",value:function(){this.resetBroadcastChannel(),this.broadcast.listen("ChatParticipantCreated",this.chatParticipantCreatedListener)}},{key:"resetBroadcastChannel",value:function(){var e=this.props.auth;e.check()?this.broadcast.setChannel("Auth.User."+e.user.id):this.broadcast.unbind()}},{key:"componentDidUpdate",value:function(e,t,n){var a=e.auth.user,r=this.props.auth.user;a.id!==r.id&&(console.info("Menu Updated"),this.resetBroadcastChannel())}},{key:"componentWillUnmount",value:function(){this.broadcast.unbind(),this.api.cancel()}},{key:"canSearchUser",value:function(){var e=this.state,t=e.loading,n=e.loadingMore;return!(t||n)}},{key:"canLoadMore",value:function(){var e=this.state,t=e.hasMore,n=e.loadingMore,a=e.loading;return t&&!n&&!a}},{key:"render",value:function(){var e=this,t=this.state,n=t.loading,a=t.loadingMore,r=t.hasMore,o=t.filters,i=t.data,s=this.props,l=s.intl,u=s.auth,f=s.activeChat,p=u.user.marketplace_stats.total_active_trades;return c.a.createElement("div",{className:"cp-chat-sidenav-main"},c.a.createElement("div",{className:"cp-chat-sidenav-header"},c.a.createElement("div",{className:"cp-chat-user-hd"},c.a.createElement("div",{className:"cp-chat-avatar mr-3"},c.a.createElement(V.a,{user:u.user,showPresence:!1,size:50})),c.a.createElement("div",{className:"cp-module-user-info flex-column justify-content-center"},c.a.createElement("div",{className:"cp-module-title"},c.a.createElement("h5",{className:"mb-0"},c.a.createElement(m.a,{defaultMessage:"Conversations",id:"chats.conversations"}))),c.a.createElement("div",{className:"cp-module-user-detail"},c.a.createElement("div",{className:"cp-text-grey d-flex my-1 align-items-center"},p>0&&c.a.createElement(N.a,{count:p,style:{backgroundColor:"#2db7f5"},className:"mb-0 mr-2"}),c.a.createElement("span",null,c.a.createElement(m.a,{defaultMessage:"Active Trades",id:"common.active_trades"})))))),c.a.createElement("div",{className:"cp-chat-search-wrapper"},c.a.createElement(P.a,{suffix:c.a.createElement(M.a,{type:"search"}),placeholder:l.formatMessage(Se.searchUsers),size:"large",onKeyUp:this.onSearchKeyUp,disabled:!this.canSearchUser(),onChange:this.onChangeUserSearch,value:o.user}))),c.a.createElement("div",{className:"cp-chat-sidenav-content"},c.a.createElement(S.a,{spinning:n},c.a.createElement("div",{ref:this.setScrollWrapper,className:"cp-chat-sidenav-scroll","data-simplebar":!0},c.a.createElement(ie.a,{useWindow:!1,getScrollParent:function(){return e.scrollParent},loadMore:this.onLoadMore,pageStart:1,hasMore:!a&&r,initialLoad:!1},c.a.createElement("div",{className:"cp-chat-user"},c.a.createElement(I.a,{dataSource:i,rowKey:function(e){return e.id},renderItem:function(t){return c.a.createElement(je,{className:"p-0"},c.a.createElement(oe,{onChatUpdated:e.onChatUpdated,active:f&&f.token===t.id,auth:u,chat:t,onOpen:e.handleChatOpen}))}})),a&&c.a.createElement(le.a,null))))))}}])&&be(t.prototype,n),a&&be(t,a),o}(o.Component),Pe=Object(i.c)(Object(s.b)((function(e){var t=e.auth;return{auth:new u.a(t)}})),W.c,l.h)(ke),Te=n("9xET"),Me=n.n(Te),Ce=n("B8+X"),Ne=n.n(Ce),xe=n("ZPTe"),Re=n.n(xe),De=n("3WF5"),Ae=n.n(De),Ue=n("mwIZ"),Be=n.n(Ue),Fe=n("k4Da"),Ie=n.n(Fe),Le=n("QpBz"),We=n.n(Le),Ve=n("OFL0"),ze=n.n(Ve),Ke=n("hw8t"),qe=n.n(Ke);function He(e){return(He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Je(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Qe(e,t){return(Qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Xe(e);if(t){var r=Xe(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Ze(this,n)}}function Ze(e,t){if(t&&("object"===He(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Xe(e){return(Xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var $e=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qe(e,t)}(o,e);var t,n,a,r=Ye(o);function o(){return Ge(this,o),r.apply(this,arguments)}return t=o,(n=[{key:"render",value:function(){var e=this.props.onToggleDrawer;return c.a.createElement("div",{className:"d-flex align-items-center w-100"},c.a.createElement("div",{className:"text-center w-100"},c.a.createElement(qe.a,{title:c.a.createElement(m.a,{defaultMessage:"Chat could not be found.",id:"chats.chat_not_found_title"}),extra:c.a.createElement(p.a,{type:"primary",className:"d-inline-block d-lg-none mt-3",onClick:e},c.a.createElement(m.a,{defaultMessage:"Show Chats",id:"chat.show_chats"})),subTitle:c.a.createElement(m.a,{defaultMessage:"Please, select a new chat to display!",id:"chats.chat_not_found_sub_title"}),status:"404"})))}}])&&Je(t.prototype,n),a&&Je(t,a),o}(o.Component),et=n("55Ip");function tt(e){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function at(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function rt(e,t){return(rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ot(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=st(e);if(t){var r=st(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return ct(this,n)}}function ct(e,t){if(t&&("object"===tt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return it(e)}function it(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function st(e){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ut=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rt(e,t)}(o,e);var t,n,a,r=ot(o);function o(){var e;nt(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return lt(it(e=r.call.apply(r,[this].concat(n))),"getUserAvatar",(function(){var t=e.props.message.user;return c.a.createElement(et.b,{to:"/profile/".concat(t.name)},c.a.createElement(V.a,{className:"align-self-end",user:t,size:40}))})),lt(it(e),"getTextDetail",(function(){var t=e.props.message;return B()(t.text)?c.a.createElement("span",null,c.a.createElement("i",{className:"la la-ban mr-1"}),c.a.createElement("span",null,c.a.createElement(m.a,{defaultMessage:"Message Deleted",id:"chats.message_deleted"}))):c.a.createElement("span",null,t.text.body)})),lt(it(e),"getTimestamp",(function(){var t=e.props.message;return t.created_at&&c.a.createElement("small",{className:"text-muted"},Object(i.g)(t.created_at))})),e}return t=o,(n=[{key:"render",value:function(){var e="right"===this.props.mode?"cp-chat-item flex-row-reverse":"cp-chat-item";return c.a.createElement("div",{className:e},this.getUserAvatar(),c.a.createElement("div",{className:"cp-bubble-block"},c.a.createElement("div",{className:"cp-bubble d-inline-block"},c.a.createElement("div",{className:"cp-message mb-2"},this.getTextDetail()),c.a.createElement("div",{className:"cp-time text-right"},this.getTimestamp()))))}}])&&at(t.prototype,n),a&&at(t,a),o}(o.Component),ft=n("UIqZ"),pt=n.n(ft);function mt(e){return(mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ht(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function yt(e,t){return(yt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=vt(e);if(t){var r=vt(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return gt(this,n)}}function gt(e,t){if(t&&("object"===mt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function vt(e){return(vt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Et=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yt(e,t)}(o,e);var t,n,a,r=bt(o);function o(){return dt(this,o),r.apply(this,arguments)}return t=o,(n=[{key:"getTimestamp",value:function(){var e=this.props.message;return c.a.createElement("span",{className:"font-weight-semi-bold"},Object(i.g)(e.created_at))}},{key:"getUserName",value:function(){var e=this.props.message;return B()(e.user)?c.a.createElement(m.a,{defaultMessage:"Unknown User",id:"common.unknown_user"}):c.a.createElement("span",{className:"font-weight-medium"},e.user.name,":")}},{key:"render",value:function(){var e=this.props.message.activity;return B()(e)||!e.body?c.a.createElement(I.a.Item,null):c.a.createElement(pt.a,{className:"font-weight-normal",dashed:!0},c.a.createElement("small",null,c.a.createElement(m.a,{id:"chat.activity_body",defaultMessage:"{user} {body} {time}",values:{time:this.getTimestamp(),body:e.body,user:this.getUserName()}})))}}])&&ht(t.prototype,n),a&&ht(t,a),o}(o.Component);function wt(e){return(wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ot(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _t(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function jt(e,t){return(jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function St(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Tt(e);if(t){var r=Tt(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return kt(this,n)}}function kt(e,t){if(t&&("object"===wt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Pt(e)}function Pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Tt(e){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ct=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jt(e,t)}(o,e);var t,n,a,r=St(o);function o(){var e;Ot(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Mt(Pt(e=r.call.apply(r,[this].concat(n))),"getUserAvatar",(function(){var t=e.props.message.user;return c.a.createElement(et.b,{to:"/profile/".concat(t.name)},c.a.createElement(V.a,{className:"align-self-end",user:t,size:40}))})),Mt(Pt(e),"isImageType",(function(e){return"image/jpeg"===e||"image/png"===e})),e}return t=o,(n=[{key:"isImage",value:function(e){switch(e){case"image/gif":case"image/jpeg":case"image/png":return!0;default:return!1}}},{key:"getAttachmentDetail",value:function(){var e=this.props,t=e.message,n=e.openCarousel,a=t.attachment;if(B()(a))return c.a.createElement("div",{className:"cp-attachment d-flex"},c.a.createElement("i",{className:"la la-ban cp-fs-lg mr-2"}),c.a.createElement("span",null,c.a.createElement(m.a,{defaultMessage:"Attachment Deleted",id:"chats.attachment_deleted"})));var r=a.url;return c.a.createElement(c.a.Fragment,null,this.isImage(a.mime_type)&&c.a.createElement("div",{className:"cp-thumbnail",onClick:function(){return n(t.id)}},c.a.createElement("img",{src:r,alt:a.name})),c.a.createElement("div",{className:"cp-attachment d-flex"},c.a.createElement("span",{className:"mr-2"},c.a.createElement("i",{className:"la la-paperclip cp-fs-lg"})),c.a.createElement("span",{className:"mr-2 fs-sm"},Object(i.f)(a.name,20)),c.a.createElement(p.a,{className:"ml-0 mb-0",type:"dashed",shape:"circle",href:r,icon:"download"})))}},{key:"getTimestamp",value:function(){var e=this.props.message;return c.a.createElement("small",{className:"text-muted"},Object(i.g)(e.created_at))}},{key:"render",value:function(){var e="right"===this.props.mode?"cp-chat-item flex-row-reverse":"cp-chat-item";return c.a.createElement("div",{className:e},this.getUserAvatar(),c.a.createElement("div",{className:"cp-bubble-block"},c.a.createElement("div",{className:"cp-bubble d-inline-block"},c.a.createElement("div",{className:"cp-message mb-2"},this.getAttachmentDetail()),c.a.createElement("div",{className:"cp-time text-right"},this.getTimestamp()))))}}])&&_t(t.prototype,n),a&&_t(t,a),o}(o.Component),Nt=n("aOJk"),xt=n.n(Nt),Rt=n("EQeY"),Dt=n.n(Rt),At=n("gQMU"),Ut=n.n(At),Bt=n("CC+v"),Ft=n.n(Bt),It=n("lB7Y"),Lt=n.n(It),Wt=n("N9UN"),Vt=n.n(Wt);function zt(e){return(zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Kt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qt(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ht(e,t){return(Ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Gt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Qt(e);if(t){var r=Qt(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Jt(this,n)}}function Jt(e,t){if(t&&("object"===zt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Qt(e){return(Qt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Yt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ht(e,t)}(o,e);var t,n,a,r=Gt(o);function o(){return Kt(this,o),r.apply(this,arguments)}return t=o,(n=[{key:"render",value:function(){var e=this.props,t=e.styleName,n=e.name,a=e.price;return c.a.createElement(Vt.a,{className:"".concat(t," cp-card-price mb-0")},c.a.createElement("h6",{className:"text-muted"},n),c.a.createElement("h4",{className:"font-weight-medium"},a))}}])&&qt(t.prototype,n),a&&qt(t,a),o}(o.Component),Zt=n("wd/R"),Xt=n.n(Zt),$t=n("ctCr"),en=n("qu0K"),tn=n.n(en),nn=n("4ztd");function an(e){return(an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function on(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function cn(e,t){return(cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function sn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=fn(e);if(t){var r=fn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return ln(this,n)}}function ln(e,t){if(t&&("object"===an(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return un(e)}function un(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fn(e){return(fn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var mn=Object(L.a)({twoFactorCode:{id:"marketplace.input_two_factor_code_placeholder",defaultMessage:"Enter your Two Factor code."},password:{id:"marketplace.input_password_placeholder",defaultMessage:"Enter your Password."}}),dn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cn(e,t)}(o,e);var t,n,a,r=sn(o);function o(){var e;rn(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return pn(un(e=r.call.apply(r,[this].concat(n))),"cancel",(function(){var t=e.props.onCancel;if("function"==typeof t)return t()})),pn(un(e),"submit",(function(){var t=e.props,n=t.form,a=t.onSubmit;n.validateFields((function(e,t){if(B()(e)&&"function"==typeof a)return a(t.code)}))})),e}return t=o,(n=[{key:"render",value:function(){var e=this.props,t=e.withTwoFactor,n=e.intl,a=this.props.form.getFieldDecorator;return c.a.createElement("div",{className:"p-2 text-left"},c.a.createElement(tn.a,null,t?c.a.createElement(tn.a.Item,{labelAlign:"left",label:c.a.createElement(m.a,{defaultMessage:"Token",id:"marketplace.token"})},a("code",{rules:[{required:!0}]})(c.a.createElement(P.a,{placeholder:n.formatMessage(mn.twoFactorCode)}))):c.a.createElement(tn.a.Item,{labelAlign:"left",label:c.a.createElement(m.a,{defaultMessage:"Password",id:"marketplace.password"})},a("code",{rules:[{required:!0}]})(c.a.createElement(P.a.Password,{placeholder:n.formatMessage(mn.password)}))),c.a.createElement(tn.a.Item,{className:"mt-2"},c.a.createElement(p.a,{type:"primary",block:!0,onClick:this.submit,className:"mb-0"},c.a.createElement("span",null,c.a.createElement(m.a,{defaultMessage:"Approve Trade",id:"marketplace.approve_trade"}))),c.a.createElement(p.a,{type:"dashed",block:!0,onClick:this.cancel},c.a.createElement("span",null,c.a.createElement(m.a,{defaultMessage:"Cancel",id:"marketplace.cancel"}))))))}}])&&on(t.prototype,n),a&&on(t,a),o}(o.Component),hn=Object(i.c)(Object(nn.a)())(dn);function yn(e){return(yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function gn(e,t){return(gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function vn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=On(e);if(t){var r=On(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return En(this,n)}}function En(e,t){if(t&&("object"===yn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return wn(e)}function wn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function On(e){return(On=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var jn=Lt.a.Countdown,Sn=Object(L.a)({approved:{id:"chats.marketplace_approved_successful",defaultMessage:"Trade has been approved."},disputed:{id:"chats.marketplace_disputed_successful",defaultMessage:"A moderator will be in touch soon."},cancelled:{id:"chats.marketplace_cancelled_successful",defaultMessage:"Trade has been cancelled."},confirmed:{id:"chats.marketplace_confirmed_successful",defaultMessage:"Trade has been marked as paid."}}),kn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gn(e,t)}(o,e);var t,n,a,r=vn(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),_n(wn(t=r.call(this,e)),"onFinishCountDown",(function(){t.update()})),_n(wn(t),"showInstructions",(function(e){Ft.a.info({content:c.a.createElement("p",{style:{whiteSpace:"pre-line"}},e.instructions)})})),_n(wn(t),"showTerms",(function(e){Ft.a.info({content:c.a.createElement("p",{style:{whiteSpace:"pre-line"}},e.terms)})})),_n(wn(t),"update",(function(){var e=t.props.onUpdate;if("function"==typeof e)return e()})),_n(wn(t),"canApproveTrade",(function(e){var n=t.props.auth;return!!e.confirmed_at&&(t.isOnGoing(e)&&(n.user.id===e.seller.id||t.userCanManageTrade(e)))})),_n(wn(t),"approve",(function(e,n){var a=t.api,r=a.axios,o=a.route,c=t.props.intl,i=o("chats.marketplace.approve",{trade:e.id});t.setState({loading:!0}),r.post(i.url(),{code:n}).then((function(e){return Object(Q.d)(e,(function(){t.setState({loading:!1}),t.update(),t.toggleVerificationForm()}),c.formatMessage(Sn.approved))})).catch((function(e){return Object(Q.a)(e,(function(){t.setState({loading:!1})}))}))})),_n(wn(t),"isOnGoing",(function(e){return!B()(e)&&("active"===e.status||"dispute"===e.status)})),_n(wn(t),"canConfirmTrade",(function(e){var n=t.props.auth,a=Xt.a.utc(e.cancels_at);return!e.confirmed_at&&(!Xt()().isAfter(a.local())&&("active"===e.status&&n.user.id===e.buyer_id))})),_n(wn(t),"confirm",(function(e){var n=t.api,a=n.axios,r=n.route,o=t.props.intl,c=r("chats.marketplace.confirm",{trade:e.id});t.setState({loading:!0}),a.post(c.url()).then((function(e){return Object(Q.d)(e,(function(){t.setState({loading:!1}),t.update()}),o.formatMessage(Sn.confirmed))})).catch((function(e){return Object(Q.a)(e,(function(){t.setState({loading:!1})}))}))})),_n(wn(t),"canCancelTrade",(function(e){var n=t.props.auth;return t.isOnGoing(e)&&(t.userCanManageTrade(e)||n.user.id===e.buyer_id)})),_n(wn(t),"cancel",(function(e){var n=t.api,a=n.axios,r=n.route,o=t.props.intl,c=r("chats.marketplace.cancel",{trade:e.id});t.setState({loading:!0}),a.post(c.url()).then((function(e){return Object(Q.d)(e,(function(e){t.setState({loading:!1}),t.update()}),o.formatMessage(Sn.cancelled))})).catch((function(e){return Object(Q.a)(e,(function(){t.setState({loading:!1})}))}))})),_n(wn(t),"canDisputeTrade",(function(e){if(!e.confirmed_at)return!1;if("active"!==e.status)return!1;var n=Xt.a.utc(e.confirmed_at),a=Xt.a.utc(e.created_at),r=Xt.a.utc(e.cancels_at).diff(a);return Xt()().diff(n.local())>r&&t.userIsPartOfTrade(e)})),_n(wn(t),"dispute",(function(e){var n=t.api,a=n.axios,r=n.route,o=t.props.intl,c=r("chats.marketplace.dispute",{trade:e.id});t.setState({loading:!0}),a.post(c.url()).then((function(e){return Object(Q.d)(e,(function(e){t.setState({loading:!1}),t.update()}),o.formatMessage(Sn.disputed))})).catch((function(e){return Object(Q.a)(e,(function(){t.setState({loading:!1})}))}))})),_n(wn(t),"getStatusColor",(function(e){switch(e){case"successful":return"#52c41a";case"active":return"#2db7f5";case"dispute":return"#faad14";case"cancelled":return"#f5222d";default:return null}})),_n(wn(t),"toggleVerificationForm",(function(){t.setState((function(e){return{showVerificationForm:!e.showVerificationForm}}))})),t.api=new J.b,t.state={showVerificationForm:!1,loading:!1},t}return t=o,(n=[{key:"userCanManageTrade",value:function(e){return this.props.auth.can("manage_marketplace")&&!this.userIsPartOfTrade(e)}},{key:"userIsPartOfTrade",value:function(e){var t=this.props.auth;return t.user.id===e.seller_id||t.user.id===e.buyer_id}},{key:"componentWillUnmount",value:function(){this.api.cancel()}},{key:"render",value:function(){var e=this,t=this.props,n=t.trade,a=t.auth;if(B()(n)||!this.isOnGoing(n))return null;var r=this.state,o=r.loading,i=r.showVerificationForm,s=a.twoFactorSetting();return c.a.createElement(S.a,{spinning:o},c.a.createElement("div",{className:"cp-trade pt-3",key:n.id},c.a.createElement("h3",{className:"text-center"},c.a.createElement("span",{className:"mr-2"},c.a.createElement(m.a,{defaultMessage:"Trade Status",id:"chats.trade_status"})),c.a.createElement("span",null,c.a.createElement(Dt.a,{color:this.getStatusColor(n.status)},Ut()(n.status)))),c.a.createElement(pt.a,null),c.a.createElement("div",{className:"px-1"},c.a.createElement(Me.a,{gutter:8},c.a.createElement(Re.a,{span:12},c.a.createElement(Yt,{price:n.formatted_amount_price,styleName:"mb-3",name:c.a.createElement(m.a,{defaultMessage:"Amount",id:"common.amount"})})),c.a.createElement(Re.a,{span:12},c.a.createElement(Yt,{price:n.formatted_rate,styleName:"mb-3",name:c.a.createElement(m.a,{defaultMessage:"Rate",id:"common.rate"})}))),c.a.createElement(Me.a,{gutter:8},c.a.createElement(Re.a,{span:12},c.a.createElement(Yt,{price:n.coin_name,name:c.a.createElement(m.a,{defaultMessage:"Coin",id:"common.coin"})})),c.a.createElement(Re.a,{span:12},c.a.createElement(Yt,{price:n.formatted_fee_price,name:c.a.createElement(m.a,{defaultMessage:"Fee",id:"common.fee"})})))),!n.confirmed_at&&c.a.createElement(c.a.Fragment,null,c.a.createElement(pt.a,null),c.a.createElement("div",{className:"text-center"},c.a.createElement(jn,{onFinish:this.onFinishCountDown,value:Xt.a.utc(n.cancels_at).local(),title:c.a.createElement(m.a,{defaultMessage:"Payment Deadline",id:"common.payment_deadline"})})),c.a.createElement(pt.a,null)),c.a.createElement("div",{className:"my-3 text-center w-100"},this.canApproveTrade(n)&&c.a.createElement("div",null,i?c.a.createElement(hn,{onSubmit:function(t){return e.approve(n,t)},onCancel:this.toggleVerificationForm,withTwoFactor:s.marketplace()}):c.a.createElement(p.a,{type:"default",shape:"round",onClick:this.toggleVerificationForm,className:"mx-0 mb-2 cp-btn-success",icon:"check-circle",size:"small"},c.a.createElement("span",null,c.a.createElement(m.a,{defaultMessage:"Release Coin",id:"trade.release_coin"})))),this.canConfirmTrade(n)&&c.a.createElement("div",null,c.a.createElement($t.a,{onConfirm:function(){return e.confirm(n)},title:c.a.createElement(m.a,{defaultMessage:"Are you sure you want to {action}?",id:"trade.mark_trade_as_paid_confirmation",values:{action:c.a.createElement("b",null,c.a.createElement(m.a,{defaultMessage:"Mark Trade as Paid",id:"trade.mark_trade_as_paid"}))}})},c.a.createElement(p.a,{type:"default",icon:"check",size:"small",className:"mx-0 mb-2",shape:"round"},c.a.createElement("span",null,c.a.createElement(m.a,{defaultMessage:"Mark Trade as Paid",id:"trade.mark_trade_as_paid"}))))),this.canCancelTrade(n)&&c.a.createElement("div",null,c.a.createElement($t.a,{onConfirm:function(){return e.cancel(n)},title:c.a.createElement(m.a,{defaultMessage:"Are you sure you want to {action}?",id:"offer.cancel_trade_confirmation",values:{action:c.a.createElement("b",null,c.a.createElement(m.a,{defaultMessage:"Cancel Trade",id:"trade.cancel_trade"}))}})},c.a.createElement(p.a,{type:"default",shape:"round",className:"cp-btn-danger mx-0 mb-2",icon:"close-circle",size:"small"},c.a.createElement("span",null,c.a.createElement(m.a,{defaultMessage:"Cancel Trade",id:"trade.cancel_trade"}))))),this.canDisputeTrade(n)&&c.a.createElement("div",null,c.a.createElement($t.a,{onConfirm:function(){return e.dispute(n)},title:c.a.createElement(m.a,{defaultMessage:"Are you sure you want to {action}?",id:"offer.raise_dispute_confirmation",values:{action:c.a.createElement("b",null,c.a.createElement(m.a,{defaultMessage:"Raise Dispute",id:"trade.raise_dispute"}))}})},c.a.createElement(p.a,{type:"default",shape:"round",className:"cp-btn-warning mx-0 mb-2",icon:"flag",size:"small"},c.a.createElement("span",null,c.a.createElement(m.a,{defaultMessage:"Raise Dispute",id:"trade.raise_dispute"})))))),c.a.createElement(pt.a,null),c.a.createElement("div",{className:"px-2 mb-3 text-center"},c.a.createElement("h5",{className:"mb-2"},c.a.createElement("a",{className:"mr-2",onClick:function(){return e.showTerms(n)}},c.a.createElement(m.a,{defaultMessage:"Terms",id:"common.terms"})),c.a.createElement("span",{className:"mr-2"},c.a.createElement(m.a,{defaultMessage:"and",id:"common.and"})),c.a.createElement("a",{className:"mr-2",onClick:function(){return e.showInstructions(n)}},c.a.createElement(m.a,{defaultMessage:"Instructions",id:"common.instruction"}))),c.a.createElement("h5",{className:"mb-2"},c.a.createElement("span",{className:"mr-2"},c.a.createElement(m.a,{defaultMessage:"{buyer} to pay {offerAmount} to {seller}",values:{seller:c.a.createElement("b",null,n.seller.name),offerAmount:c.a.createElement("b",null,n.formatted_offer_amount),buyer:c.a.createElement("b",null,n.buyer.name)},id:"chats.trade_payment_instruction"}))),c.a.createElement("h5",null,c.a.createElement("span",{className:"mr-2"},n.payment_method_name),n.payment_method_description&&c.a.createElement(xt.a,{overlayStyle:{maxWidth:250},content:n.payment_method_description,title:c.a.createElement(m.a,{id:"common.payment_method_description",defaultMessage:"Description"}),trigger:"click"},c.a.createElement(M.a,{type:"question-circle",theme:"filled"})))),c.a.createElement(pt.a,null)))}}])&&bn(t.prototype,n),a&&bn(t,a),o}(o.Component),Pn=Object(i.c)(Object(s.b)((function(e){var t=e.auth;return{auth:new u.a(t)}})),W.c)(kn),Tn=n("IztG"),Mn=n.n(Tn),Cn=n("fTA7"),Nn=n.n(Cn);function xn(e){return(xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Dn(e,t){return(Dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function An(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Fn(e);if(t){var r=Fn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Un(this,n)}}function Un(e,t){if(t&&("object"===xn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Bn(e)}function Bn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fn(e){return(Fn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var In=P.a.TextArea,Ln=Object(L.a)({successful:{id:"admin.review_submitted_successful",defaultMessage:"You review has been submitted."},review:{id:"admin.textarea_review_placeholder",defaultMessage:"Write a review..."}}),Wn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Dn(e,t)}(o,e);var t,n,a,r=An(o);function o(e){var t,n,a,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),t=r.call(this,e),n=Bn(t),c=function(e){e.preventDefault();var n=t.props,a=n.form,r=n.intl,o=n.trade,c=t.api,i=c.axios,s=(0,c.route)("chats.marketplace.submit-review",{trade:o.id});a.validateFields((function(e,n){B()(e)&&(i.post(s.url(),n).then((function(e){return Object(Q.c)(e,a,(function(){t.setState({loading:!1,submitted:!0})}),r.formatMessage(Ln.successful))})).catch((function(e){return Object(Q.b)(e,a,n,(function(){t.setState({loading:!1})}))})),t.setState({loading:!0}))}))},(a="handleSubmit")in n?Object.defineProperty(n,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):n[a]=c,t.api=new J.b,t.state={submitted:!1,loading:!1},t}return t=o,(n=[{key:"canSubmitReview",value:function(){var e=this.props,t=e.trade,n=e.auth,a=this.state.submitted;return"successful"===t.status&&(t.buyer_id===n.user.id?t.seller_rateable&&!a:t.seller_id===n.user.id&&t.buyer_rateable&&!a)}},{key:"componentWillUnmount",value:function(){this.api.cancel()}},{key:"render",value:function(){if(!this.canSubmitReview())return null;var e=this.props,t=e.intl,n=e.form.getFieldDecorator,a=this.state.loading;return c.a.createElement("div",{className:"px-3"},c.a.createElement(Mn.a,{content:c.a.createElement(tn.a,{onSubmit:this.handleSubmit},c.a.createElement(tn.a.Item,null,n("comment",{rules:[{type:"string",required:!0,min:3,max:200}]})(c.a.createElement(In,{style:{resize:"none"},placeholder:t.formatMessage(Ln.review),rows:3}))),c.a.createElement(tn.a.Item,{className:"d-flex align-items-center"},c.a.createElement("span",{className:"mr-2"},c.a.createElement(m.a,{defaultMessage:"Rate",id:"common.rate"}),":"),n("rating",{rules:[{type:"number",required:!0,min:1,max:5}]})(c.a.createElement(Nn.a,null))),c.a.createElement(tn.a.Item,null,c.a.createElement(p.a,{htmlType:"submit",loading:a,className:"mb-0",shape:"round",type:"primary"},c.a.createElement("span",null,c.a.createElement(m.a,{defaultMessage:"Submit Review",id:"marketplace.submit_review"})))))}))}}])&&Rn(t.prototype,n),a&&Rn(t,a),o}(o.Component),Vn=Object(i.c)(Object(s.b)((function(e){var t=e.auth;return{auth:new u.a(t)}})),Object(nn.a)())(Wn),zn=n("E4Ak");function Kn(e){return(Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Hn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qn(Object(n),!0).forEach((function(t){$n(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Gn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Jn(e,t){return(Jn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Xn(e);if(t){var r=Xn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Yn(this,n)}}function Yn(e,t){if(t&&("object"===Kn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Zn(e)}function Zn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xn(e){return(Xn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ea=P.a.TextArea,ta=Object(L.a)({inputMessage:{id:"chats.input_message_placeholder",defaultMessage:"Type a message..."}}),na=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jn(e,t)}(l,e);var t,n,a,s=Qn(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),$n(Zn(t=s.call(this,e)),"openCarousel",(function(e){var n=A()(t.getImagesData(),(function(t){return t.id===e}));n>=0&&t.setState({carouselVisibility:!0,selectedImage:n})})),$n(Zn(t),"closeCarousel",(function(){t.setState({carouselVisibility:!1})})),$n(Zn(t),"marketplaceTradeSavedListener",(function(e){t.fetchMarketplaceTrade()})),$n(Zn(t),"newChatMessageListener",(function(e){var n=t.props.auth;if(!B()(e.message)){var a=e.message;a.user_id!==n.user.id&&t.updateParticipation(a.chat_id),t.setState((function(e){var n=e.data;return{data:t.sortMessages(n.concat(a))}}),(function(){t.scrollToBottom()}))}})),$n(Zn(t),"onMarketplaceTradeUpdate",(function(){t.toggleMarketplaceTradeDrawer(),t.fetchMarketplaceTrade()})),$n(Zn(t),"updateParticipation",(function(e){var n=t.api,a=n.axios,r=n.route;if(e){var o=r("chats.update-participation",{chat:e});a.post(o.url()).then((function(e){return Object(Q.d)(e)})).catch((function(e){return Object(Q.a)(e)}))}})),$n(Zn(t),"sendText",(function(){var e=t.state,n=e.chat,a=e.text;if(a&&t.canSendMessage()){var r=t.api,o=r.axios,c=(0,r.route)("chats.messages.save-text",{chat:n.id});o.post(c.url(),{body:a}).then((function(e){return Object(Q.d)(e,(function(){t.setState({sendingText:!1})}))})).catch((function(e){return Object(Q.a)(e,(function(){t.setState({sendingText:!1})}))})),t.setState({sendingText:!0,text:""},(function(){t.scrollToBottom()}))}})),$n(Zn(t),"beforeUpload",(function(e){var n=t.canSendMessage();return t.setState({sendingAttachment:n},(function(){n&&t.scrollToBottom()})),n})),$n(Zn(t),"handleUploadSuccess",(function(e){t.setState((function(n){var a=n.data;return{sendingAttachment:!1,data:t.sortMessages(a.concat(e))}}),(function(){t.scrollToBottom()}))})),$n(Zn(t),"handleUploadError",(function(e){ze()(e,"file")&&e.file.forEach((function(e){return We.a.error(e)}))})),$n(Zn(t),"fetchMessages",(function(){var e=t.state,n=e.filters,a=e.chat,r=Hn(Hn({},e.params),{},{current:1});if(!B()(a)&&a.id){var o=t.api.route("chats.messages.table",{chat:a.id}).url();t.mesagePagination=new se.a(t.api,o),t.setState({loading:!0,data:[]}),t.mesagePagination.fetchData(r,n,(function(e){var n=Boolean(e.links.next);t.setState((function(){return{data:t.sortMessages(e.data),loading:!1,hasMore:!1,params:Hn(Hn({},r),{},{total:e.meta.total})}}),(function(){var e=t.scrollParent;void 0!==e&&(e.scrollTop=e.scrollHeight,t.setState({hasMore:n}),console.log("Showing Latest Messages"))}))}),(function(){t.setState({loading:!1})}))}})),$n(Zn(t),"sortMessages",(function(e){return Array.isArray(e)?(e=e.sort((function(e,t){return Object(i.d)(e.created_at,t.created_at)})),R()(e,"id")):e})),$n(Zn(t),"onLoadMore",(function(){if(t.canLoadMoreMessages()){var e=t.state,n=e.params,a=e.filters,r=Hn(Hn({},n),{},{current:n.current+1});t.mesagePagination.fetchData(r,a,(function(e){t.setState((function(n){var a=n.data;return{data:t.sortMessages(a.concat(e.data)),params:Hn(Hn({},r),{},{total:e.meta.total}),loadingMore:!1,hasMore:Boolean(e.links.next)}}))}),(function(){t.setState({loadingMore:!1})})),t.setState({loadingMore:!0})}})),$n(Zn(t),"getUserAvatar",(function(){var e=t.getHighlightedParticipant();return B()(e)?c.a.createElement(H.a,{icon:"message",size:40}):c.a.createElement(V.a,{showPresence:!1,user:e.user,size:40})})),$n(Zn(t),"onChangeText",(function(e){t.setState({text:e.target.value})})),$n(Zn(t),"handleTextKeyUp",(function(e){"Enter"===e.key&&t.sendText()})),$n(Zn(t),"toggleMarketplaceTradeDrawer",(function(){t.changeFullscreen(!1),t.setState((function(e){return{marketplaceTradeDrawerState:!e.marketplaceTradeDrawerState}}))})),$n(Zn(t),"setScrollWrapper",(function(e){if(e!==t.scrollWrapper&&null!==e){var n=new ue.a(e);t.scrollParent=n.getScrollElement(),t.scrollWrapper=e}})),$n(Zn(t),"getStatusColor",(function(e){switch(e){case"successful":return"#52c41a";case"active":return"#2db7f5";case"dispute":return"#faad14";case"cancelled":return"#f5222d";default:return null}})),t.broadcast=new G.a,t.api=new J.b,t.state={chat:{},selectedImage:0,carouselVisibility:!1,loadingChat:!1,data:[],hasMore:!1,params:{total:0,pageSize:40,current:1},marketplaceTrade:{},marketplaceTradeDrawerState:!1,loading:!1,loadingMore:!1,text:"",sendingAttachment:!1,sendingText:!1},t}return t=l,(n=[{key:"componentDidMount",value:function(){this.fetchChat()}},{key:"resetBroadcastChannel",value:function(){var e=this.state.chat;B()(e)?this.broadcast.unbind():this.broadcast.setChannel("App.Chat."+e.id)}},{key:"getImagesData",value:function(){var e=this,t=this.state.data,n=Ie()(t,(function(t){return"attachment"===Be()(t,"type")&&e.isImage(Be()(t,"attachment.mime_type"))}));return Ae()(n,(function(e){return{src:Be()(e,"attachment.url"),caption:Be()(e,"attachment.name"),id:Be()(e,"id")}}))}},{key:"isImage",value:function(e){switch(e){case"image/gif":case"image/jpeg":case"image/png":return!0;default:return!1}}},{key:"fetchMarketplaceTrade",value:function(){var e=this,t=this.state.chat;if(!B()(t)&&t.id){var n=this.api,a=n.axios,r=(0,n.route)("chats.latest-marketplace-trade",{chat:t.id});a.post(r.url()).then((function(t){return Object(Q.d)(t,(function(t){e.setState({marketplaceTrade:t},(function(){e.scrollToBottom()}))}))})).catch((function(e){return Object(Q.a)(e)}))}}},{key:"bindBroadcastEvents",value:function(){this.resetBroadcastChannel(),this.broadcast.listen("MarketplaceTradeSaved",this.marketplaceTradeSavedListener),this.broadcast.listen("NewChatMessage",this.newChatMessageListener)}},{key:"scrollToBottom",value:function(){var e=this.scrollParent;e&&(e.scrollTop=e.scrollHeight)}},{key:"canSendMessage",value:function(){return!B()(this.state.chat)&&!this.state.sendingAttachment&&!this.state.sendingText&&this.showMarketplaceTrades()}},{key:"canLoadMoreMessages",value:function(){var e=this.state,t=e.hasMore,n=e.loadingMore,a=e.loading;return t&&!n&&!a}},{key:"componentWillUnmount",value:function(){this.broadcast.unbind(),this.api.cancel()}},{key:"fetchChat",value:function(){var e=this,t=this.api,n=t.axios,a=t.route,r=this.props.activeChat;if(!B()(r)){var o=a("chats.get",{chat:r.token});n.post(o.url()).then((function(t){return Object(Q.d)(t,(function(t){e.setState({loadingChat:!1,chat:t},(function(){e.fetchMessages(),e.fetchMarketplaceTrade(),e.updateParticipation(t.id),e.bindBroadcastEvents()}))}))})).catch((function(t){return Object(Q.a)(t,(function(){e.setState({loadingChat:!1})}))})),this.setState({loadingChat:!0,chat:{}})}}},{key:"getHighlightedParticipant",value:function(){if(B()(this.highlightedParticpant)){var e=this.state.chat,t=this.props.auth,n=e.participants;this.highlightedParticpant=K()(n,(function(e){return!B()(e.user)&&e.user.id!==t.user.id}))}return this.highlightedParticpant}},{key:"getChatTitle",value:function(){var e=this.state.chat,t=this.getHighlightedParticipant(),n=e.participants;if(B()(t))return c.a.createElement(m.a,{defaultMessage:"You and {total} other(s)",id:"chats.default_title",values:{total:n.length}});var a=c.a.createElement(et.b,{to:"/profile/".concat(t.user.name)},t.user.name);return n.length>1?c.a.createElement(m.a,{defaultMessage:"{user} and {total} other(s)",id:"chats.view_title",values:{total:n.length-1,user:a}}):a}},{key:"changeFullscreen",value:function(e){var t=this.props.onChangeFullscreen;if("function"==typeof t)return t(e)}},{key:"showMarketplaceTrades",value:function(){var e=this.state.marketplaceTrade;return!B()(e)&&("active"===e.status||"dispute"===e.status)}},{key:"render",value:function(){var e=this,t=this.state,n=t.chat,a=t.data,i=t.text,s=t.marketplaceTrade,l=t.loadingChat,u=t.loading,f=t.loadingMore,p=t.hasMore,m=t.marketplaceTradeDrawerState,d=t.selectedImage,h=t.carouselVisibility,y=this.props,b=y.auth,g=y.intl,v=y.fullscreen,E=y.onToggleFullscreen,w=y.onToggleDrawer;if(B()(n))return l?c.a.createElement(le.a,null):c.a.createElement($e,{onToggleDrawer:w});var O=this.api.route("chats.messages.save-attachment",{chat:n.id});return c.a.createElement(o.Fragment,null,c.a.createElement("div",{className:"cp-chat-main animated fadeIn"},c.a.createElement("div",{className:"cp-chat-main-header"},c.a.createElement("span",{className:"d-block d-lg-none cp-chat-btn"},c.a.createElement("i",{className:"cp-icon-btn la la-comments",onClick:w})),c.a.createElement("div",{className:"cp-chat-main-header-info"},c.a.createElement("div",{className:"cp-chat-avatar mr-2 d-none d-sm-block"},this.getUserAvatar()),c.a.createElement("div",{className:"cp-chat-contact-name"},this.getChatTitle())),this.showMarketplaceTrades()&&c.a.createElement(M.a,{onClick:this.toggleMarketplaceTradeDrawer,type:"dollar-circle",theme:"filled",className:"animated flash infinite slow mr-2 cp-fs-2x cp-icon-btn",style:{color:this.getStatusColor(s.status)}}),v?c.a.createElement("i",{className:"cp-icon-btn la la-compress ml-2 cp-fs-2x",onClick:E}):c.a.createElement("i",{className:"cp-icon-btn la la-expand ml-2 cp-fs-2x",onClick:E})),this.showMarketplaceTrades()&&c.a.createElement(r.a,{visible:m,closable:!1,width:320,onClose:this.toggleMarketplaceTradeDrawer,placement:"right"},c.a.createElement(Pn,{onUpdate:this.onMarketplaceTradeUpdate,trade:s})),c.a.createElement(S.a,{spinning:u},c.a.createElement("div",{ref:this.setScrollWrapper,className:"cp-chat-list-scroll","data-simplebar":!0},c.a.createElement(ie.a,{useWindow:!1,loadMore:this.onLoadMore,getScrollParent:function(){return e.scrollParent},isReverse:!0,hasMore:!f&&p,pageStart:1,initialLoad:!1},f&&c.a.createElement(le.a,null),c.a.createElement(I.a,{dataSource:a,rowKey:function(e){return e.id},renderItem:function(t){var n=t.user_id===b.user.id;switch(t.type){case"text":return c.a.createElement(ut,{mode:n?"right":"left",message:t});case"attachment":return c.a.createElement(Ct,{openCarousel:e.openCarousel,mode:n?"right":"left",message:t});case"activity":return c.a.createElement(Et,{message:t});default:return c.a.createElement(I.a.Item,null)}}}),c.a.createElement(Vn,{trade:s})))),c.a.createElement("div",{className:"cp-chat-main-footer"},c.a.createElement(Me.a,{gutter:8,className:"d-flex align-items-center"},c.a.createElement(Re.a,{xs:18,sm:20},c.a.createElement(ea,{onKeyUp:this.handleTextKeyUp,placeholder:g.formatMessage(ta.inputMessage),rows:2,value:i,disabled:!this.canSendMessage(),autoFocus:!0,style:{maxHeight:"48px",resize:"none"},onChange:this.onChangeText})),c.a.createElement(Re.a,{xs:6,sm:4},c.a.createElement(Me.a,{gutter:4},c.a.createElement(Re.a,{span:12},c.a.createElement("div",{className:"cp-icon-btn"},c.a.createElement(Ne.a,{showUploadList:!1,beforeUpload:this.beforeUpload,action:O.url(),customRequest:J.d,onSuccess:this.handleUploadSuccess,onError:this.handleUploadError,withCredentials:!0},c.a.createElement("i",{className:"la la-paperclip cp-fs-2x"})))),c.a.createElement(Re.a,{span:12},c.a.createElement("i",{className:"cp-icon-btn la la-paper-plane cp-fs-2x",onClick:this.sendText}))))))),c.a.createElement(zn.b,null,h&&c.a.createElement(zn.a,{onClose:this.closeCarousel},c.a.createElement(zn.c,{currentIndex:d,views:this.getImagesData()}))))}}])&&Gn(t.prototype,n),a&&Gn(t,a),l}(o.Component),aa=Object(i.c)(Object(s.b)((function(e){var t=e.auth;return{auth:new u.a(t)}})),W.c)(na),ra=n("QprK"),oa=n.n(ra),ca=n("TJpk");function ia(e){return(ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sa(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function la(e,t){return(la=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ua(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=ma(e);if(t){var r=ma(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return fa(this,n)}}function fa(e,t){if(t&&("object"===ia(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return pa(e)}function pa(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ma(e){return(ma=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function da(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ha=Object(L.a)({pageTitle:{id:"meta.title.chat",defaultMessage:"Chat | {name}"}}),ya=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&la(e,t)}(i,e);var t,n,a,o=ua(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),da(pa(t=o.call(this,e)),"onToggleDrawer",(function(){t.setState((function(e){return{drawerState:!e.drawerState,fullscreen:!1}}))})),da(pa(t),"onToggleFullscreen",(function(){t.setState((function(e){return{fullscreen:!e.fullscreen,drawerState:!1}}))})),da(pa(t),"onChangeFullscreen",(function(e){t.setState({fullscreen:e})})),da(pa(t),"getActiveChatParams",(function(){var e=t.props.location,n=Object(l.g)(e.pathname,{exact:!0,path:fe.a["chat.view"].path,strict:!1});return n&&n.params})),t.state={drawerState:!1,fullscreen:!1},t}return t=i,(n=[{key:"getPageTitle",value:function(){return this.props.intl.formatMessage(ha.pageTitle,{name:oa.a.name})}},{key:"render",value:function(){var e=this.getActiveChatParams(),t=this.state,n=t.drawerState,a=t.fullscreen,o=c.a.createElement(Pe,{activeChat:e});return c.a.createElement(c.a.Fragment,null,c.a.createElement(ca.Helmet,null,c.a.createElement("title",null,this.getPageTitle())),c.a.createElement(_.a,{onChange:this.onChangeFullscreen,enabled:a},c.a.createElement("div",{className:"cp-app-module cp-chat-module"},c.a.createElement("div",{className:"cp-chat-module-box"},c.a.createElement("div",{className:"d-block d-lg-none"},c.a.createElement(r.a,{visible:n,closable:!1,onClose:this.onToggleDrawer,placement:"left"},o)),c.a.createElement("div",{className:"cp-chat-sidenav d-none d-lg-flex"},o),e?c.a.createElement(aa,{key:e.token,onChangeFullscreen:this.onChangeFullscreen,onToggleFullscreen:this.onToggleFullscreen,fullscreen:a,onToggleDrawer:this.onToggleDrawer,activeChat:e}):c.a.createElement(w,{onToggleDrawer:this.onToggleDrawer})))))}}])&&sa(t.prototype,n),a&&sa(t,a),i}(o.Component);t.default=Object(i.c)(Object(s.b)((function(e){var t=e.auth;return{auth:new u.a(t)}})),W.c,l.h)(ya)},wUfQ:function(e,t,n){"use strict";var a=n("o0o1"),r=n.n(a);function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u={base:1e3,precision:2,decimalSeparator:".",lowerCase:!1,space:!1,units:["","K","M","B","T","P","E"]},f=function(e){var t=parseFloat(e);if(Number.isNaN(t))throw new Error("Value must be a valid number");if(t>Number.MAX_SAFE_INTEGER||t<Number.MIN_SAFE_INTEGER)throw new RangeError("Value is either too big or too small");return t},p=r.a.mark((function e(t,n){var a,o,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n,o=0;case 2:if(!((c=t/a)<1)){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,{result:c,count:++o};case 8:a*=n,e.next=2;break;case 11:case"end":return e.stop()}}),e)})),m=function(e,t){if(!Number.isFinite(e))throw new Error("Value must be a finite number");if(!Number.isInteger(t)||t<0)throw new Error("Precision must be a non-negative integer");return Number.isInteger(e)?e:parseFloat(e.toFixed(t))};t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s(s({},u),t);if(!Array.isArray(n.units)||!n.units.length)throw new Error("Units must be an array");var a=f(e),r=a<0?"-":"";a=Math.abs(a);var c,i=0,l=o(p(a,n.base));try{for(l.s();!(c=l.n()).done;){var d=c.value;a=d.result,i=d.count}}catch(e){l.e(e)}finally{l.f()}i=i>n.units.length?n.units.length-1:i;var h=n.lowerCase?n.units[i].toLowerCase():n.units[i],y=n.space?" ":"",b=m(a,n.precision),g=b.toString().replace(".",n.decimalSeparator);return"".concat(r).concat(g).concat(y).concat(h)}}}]);